global
  log stdout format raw local0
  maxconn 2048

defaults
  log global
  mode tcp
  option tcplog
  timeout connect 5s
  timeout client  1m
  timeout server  1m

frontend fe_smtp_25
  bind *:25
  default_backend be_smtp_25

backend be_smtp_25
  balance roundrobin
  server-template ms 2 mailserver:25 check inter 2s fall 2 rise 1 resolvers docker init-addr none

frontend fe_submission_587
  bind *:587
  default_backend be_submission_587

backend be_submission_587
  balance roundrobin
  server-template ms 2 mailserver:587 check inter 2s fall 2 rise 1 resolvers docker init-addr none

frontend fe_imap_143
  bind *:143
  default_backend be_imap_143

backend be_imap_143
  balance roundrobin
  server-template ms 2 mailserver:143 check inter 2s fall 2 rise 1 resolvers docker init-addr none

frontend fe_http
  mode http
  option httplog
  bind *:80
  default_backend be_rainloop

backend be_rainloop
  mode http
  server rl rainloop:8888 check
  server-template rl 2 rainloop:8888 check inter 2s fall 2 rise 1 resolvers docker init-addr none

listen stats
  mode http
  bind *:8404
  stats enable
  stats uri /
  stats refresh 5s

resolvers docker
  nameserver dns 127.0.0.11:53
  resolve_retries 3
  timeout resolve 1s
  timeout retry 1s
  hold valid 10s
